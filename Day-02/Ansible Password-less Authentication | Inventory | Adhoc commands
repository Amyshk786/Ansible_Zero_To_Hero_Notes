


Day-02 - Ansible Password-less Authentication | Inventory | Adhoc commands
================================================================================


For Password Less Authentication got to the GitHub Repo and follow the steps.




There is a way that has to be there for Ansible to know what are its manage nodes and that process is called as Ansible inventory actually it's just a file so you just provide Ansible a file and within the file you just put the name of your manage notes name is nothing but the user as well as the IP address now the Ansible inventory can be written in two formats initially when Ansible was uh incepted the only way of doing it is using the inventory.ini file but now you can also put the inventory in the YAML file format but the most popular approach is the inventory.ini file what is inventory.ini file don't worry ini is just an extension.


# Please refer this Ad-Hoc Command Documentation as It is Important
Link - https://docs.ansible.com/ansible/2.8/user_guide/intro_adhoc.html



# Please refer this for Ansible Built-In Modules Documentation as It is Important
Link - https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html







------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

GitHub Notes - 
================



# How to setup Password-less Authentication

## EC2 Instances

### Using Public Key

```
ssh-copy-id -f "-o IdentityFile <PATH TO PEM FILE>" ubuntu@<INSTANCE-PUBLIC-IP>
```

- ssh-copy-id: This is the command used to copy your public key to a remote machine.
- -f: This flag forces the copying of keys, which can be useful if you have keys already set up and want to overwrite them.
- "-o IdentityFile <PATH TO PEM FILE>": This option specifies the identity file (private key) to use for the connection. The -o flag passes this option to the underlying ssh command.
- ubuntu@<INSTANCE-IP>: This is the username (ubuntu) and the IP address of the remote server you want to access.

### Using Password 

- Go to the file `/etc/ssh/sshd_config.d/60-cloudimg-settings.conf`
- Update `PasswordAuthentication yes`
- Restart SSH -> `sudo systemctl restart ssh`









------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------



# Inventory
============

Ansible inventory file is a fundamental component of Ansible that defines the hosts (remote systems) that you want to manage and the groups those hosts belong to. The inventory file can be static (a simple text file) or dynamic (generated by a script). It provides Ansible with the information about the remote nodes to communicate with during its operations.




## Static Inventory
===================

A static inventory file is typically a plain text file (usually named hosts or inventory) and is structured in INI or YAML format. Here are examples of both formats:






### INI Format

```
# inventory file: hosts

[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com
db2.example.com

[all:vars]
ansible_user=admin
ansible_ssh_private_key_file=/path/to/key
```







### YAML

```
# inventory file: hosts.yaml

all:
  vars:
    ansible_user: admin
    ansible_ssh_private_key_file: /path/to/key
  children:
    webservers:
      hosts:
        web1.example.com:
        web2.example.com:
    dbservers:
      hosts:
        db1.example.com:
        db2.example.com:
```








------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------



## Dynamic Inventory
=====================

A dynamic inventory is generated by a script or plugin and can be used for environments where hosts are constantly changing (e.g., cloud environments). The script or plugin fetches the list of hosts from a source like AWS, GCP, or any other dynamic source.

Here is an example of a dynamic inventory script for AWS EC2:

```
#!/usr/bin/env python

import json
import boto3

def get_aws_ec2_inventory():
    ec2 = boto3.client('ec2')
    instances = ec2.describe_instances()
    inventory = {
        'all': {
            'hosts': [],
            'vars': {
                'ansible_user': 'ec2-user',
                'ansible_ssh_private_key_file': '/path/to/key'
            }
        },
        '_meta': {
            'hostvars': {}
        }
    }

    for reservation in instances['Reservations']:
        for instance in reservation['Instances']:
            if instance['State']['Name'] == 'running':
                public_ip = instance['PublicIpAddress']
                inventory['all']['hosts'].append(public_ip)
                inventory['_meta']['hostvars'][public_ip] = {
                    'ansible_host': public_ip
                }

    print(json.dumps(inventory, indent=2))

if __name__ == '__main__':
    get_aws_ec2_inventory()
```







## Usage

```
ansible-playbook -i inventory <Adhoc command or Playbook.yml>
```









